{% extends "base_dashboard.html" %}
{% block title %}{{ lesson_class.title }} - LinguaLeap{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto py-12 px-6 font-display">
  <h2 class="text-3xl font-bold mb-4 text-gray-900 dark:text-white">{{ lesson_class.title }}</h2>
  <p class="text-gray-700 dark:text-gray-300 mb-6">{{ lesson_class.description }}</p>

  <!-- Info del Deck -->
  <div class="bg-white dark:bg-background-dark/50 p-4 rounded-lg mb-6 border">
    <div class="flex justify-between items-start">
      <div>
        <p class="text-sm text-gray-500">Deck</p>
        <h3 class="font-semibold text-lg">{{ lesson_class.deck.title }}</h3>
        <p class="text-sm text-gray-500">Creado por {{ lesson_class.deck.owner.username }}</p>
      </div>
      <div class="text-sm text-gray-600 text-right">
        {{ lesson_class.deck.cards.count }} tarjetas
        {% if lesson_class.deck.visibility == 'public' %}
          <div class="mt-1 inline-block px-2 py-0.5 bg-green-100 text-green-800 rounded-full">PÃºblico</div>
        {% else %}
          <div class="mt-1 inline-block px-2 py-0.5 bg-gray-100 text-gray-700 rounded-full">Privado</div>
        {% endif %}
      </div>
    </div>

    <!-- Vista previa (hasta 3 cartas) -->
    <div class="mt-4">
      <p class="text-sm text-gray-500 mb-2">Vista previa</p>
      <div class="grid gap-3 sm:grid-cols-3">
        {% with cards=lesson_class.deck.cards.all %}
          {% if cards %}
            {% for card in cards|slice:":3" %}
              <div class="p-3 bg-gray-50 dark:bg-gray-900 rounded border">
                <div class="text-sm font-medium">{{ card.front }}</div>
                <div class="text-xs text-gray-500 mt-2">â†’ {{ card.back }}</div>
              </div>
            {% endfor %}
          {% else %}
            <div class="text-sm text-gray-500">Este deck aÃºn no tiene tarjetas.</div>
          {% endif %}
        {% endwith %}
      </div>
    </div>
  </div>

  <!-- Estado de progreso -->
  {% if progress.completed %}
    <div class="bg-green-100 text-green-800 p-4 rounded-lg font-semibold mb-4">âœ… Ya completaste esta clase</div>
  {% else %}
    <form method="POST">
      {% csrf_token %}
      <button type="submit" class="px-6 py-3 bg-primary text-white font-bold rounded-lg hover:bg-primary/90 transition">Marcar como completada</button>
    </form>
  {% endif %}

  <!-- BotÃ³n Estudiar (solo si hay cartas y la vista ya validÃ³ acceso) -->
  <div class="mt-6">
    {% if lesson_class.deck.cards.count > 0 %}
      <a href="{% url 'study:start' lesson_class.deck.id %}" class="inline-block mt-4 px-6 py-3 bg-purple-600 text-white rounded-lg shadow hover:bg-purple-500/90 transition">
        ðŸ§  Estudiar este Deck
      </a>
    {% else %}
      <button class="inline-block mt-4 px-6 py-3 bg-gray-300 text-gray-600 rounded-lg shadow cursor-not-allowed" disabled>Sin tarjetas</button>
    {% endif %}
  </div>
</div>
{% endblock %}
